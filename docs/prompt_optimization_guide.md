# Prompt 优化指南

## 当前 Prompt 的问题分析

### 1. 结构性问题
- **过于简单**: 缺乏层次化的指导结构
- **不够具体**: 没有针对不同情绪类型的差异化策略
- **缺乏上下文**: 没有充分利用对话历史和状态信息

### 2. 功能性问题
- **缺乏危机检测**: 无法识别和处理危机情况
- **情绪处理粗糙**: 没有考虑情绪强度和变化
- **回复质量不稳定**: 缺乏明确的回复结构指导

### 3. 用户体验问题
- **回复风格不统一**: 缺乏一致的人格特征
- **缺乏个性化**: 没有根据用户特征调整回复
- **引导效果差**: 缺乏有效的对话引导策略

## 优化方案

### 1. 结构化改进

#### 原始 Prompt 结构
```
简单描述 → 用户状态 → 知识片段 → 用户表达 → 作答规范
```

#### 优化后结构
```
角色定义 → 状态分析 → 专业知识 → 危机评估 → 策略指导 → 结构要求 → 示例格式
```

### 2. 情绪适配策略

#### 情绪特定指导
```python
EMOTION_STYLES = {
    "sad": {
        "tone": "温暖、理解、陪伴",
        "approach": "先共情，再提供希望和陪伴",
        "avoid": "避免过度乐观或急于解决问题"
    },
    "angry": {
        "tone": "冷静、理解、引导", 
        "approach": "先认可情绪，再引导理性思考",
        "avoid": "避免对抗或火上浇油"
    }
}
```

### 3. 对话轮次策略

#### 轮次特定目标
```python
ROUND_STRATEGIES = {
    1: "建立信任，了解用户基本情况和需求",
    2: "深入探索，引导用户表达更多细节", 
    3: "提供支持，根据前两轮信息给出针对性建议",
    4: "巩固效果，总结并鼓励用户继续表达",
    5: "深化干预，提供更具体的行动建议"
}
```

### 4. 危机检测机制

#### 关键词检测
```python
CRISIS_KEYWORDS = {
    "自杀": ["自杀", "不想活了", "结束生命"],
    "自残": ["自残", "割腕", "伤害自己"],
    "绝望": ["绝望", "没有希望", "活不下去"]
}
```

### 5. 回复结构优化

#### 三段式结构
1. **共情阶段** (1-2句): 真实理解用户感受
2. **支持阶段** (1-2句): 根据情绪类型提供支持
3. **引导阶段** (1句): 温和引导继续表达

## 实施建议

### 1. 渐进式优化
- 先实施基础的情绪适配策略
- 再添加危机检测功能
- 最后完善个性化特征

### 2. A/B 测试
- 对比优化前后的回复质量
- 收集用户反馈数据
- 持续迭代改进

### 3. 监控指标
- 用户满意度评分
- 对话轮次数量
- 情绪改善程度
- 危机识别准确率

## 高级优化方向

### 1. 动态 Prompt 生成
- 根据用户历史行为调整策略
- 实时学习用户偏好
- 个性化回复风格

### 2. 多模态情绪识别
- 结合文本、语音、表情识别
- 更准确的情绪状态判断
- 更精细的情绪强度评估

### 3. 知识图谱集成
- 构建心理学知识图谱
- 更精准的知识检索
- 更专业的建议生成

## 最佳实践

### 1. Prompt 设计原则
- **明确性**: 指令清晰，避免歧义
- **一致性**: 保持风格和策略的一致性
- **可扩展性**: 便于添加新功能和策略
- **可测试性**: 便于评估和优化效果

### 2. 内容质量控制
- 避免有害或不当内容
- 确保专业性和准确性
- 保护用户隐私和安全

### 3. 持续改进
- 定期收集用户反馈
- 分析对话数据
- 更新优化策略 